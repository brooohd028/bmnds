<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bumdes Gunung Mulia - Peternakan Itik</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">
    <div class="container mt-4">
        <header class="text-center mb-4">
            <h1 class="display-5 text-primary">Bumdes Gunung Mulia</h1>
            <p class="lead">Peternakan Itik Petelur (750 Ekor)</p>
        </header>

        <!-- Form Input Transaksi -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-primary text-white">
                <h3>Input Transaksi Operasional</h3>
            </div>
            <div class="card-body">
                <form id="transactionForm">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="tanggal" class="form-label">Tanggal</label>
                            <input type="date" class="form-control" id="tanggal" required>
                        </div>
                        <div class="col-md-6">
                            <label for="jenis" class="form-label">Jenis Transaksi</label>
                            <select class="form-select" id="jenis" required>
                                <option value="">Pilih Jenis...</option>
                                <option value="masuk">Pemasukan</option>
                                <option value="keluar">Pengeluaran</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="kategori" class="form-label">Kategori</label>
                            <select class="form-select" id="kategori" required>
                                <option value="">Pilih Kategori...</option>
                                <optgroup label="Pemasukan">
                                    <option value="penjualan telur">Penjualan Telur</option>
                                    <option value="penjualan itik">Penjualan Itik</option>
                                    <option value="bantuan">Bantuan Pemerintah</option>
                                </optgroup>
                                <optgroup label="Pengeluaran">
                                    <option value="makanan itik">Makanan Itik</option>
                                    <option value="obat-obatan">Obat-obatan</option>
                                    <option value="gaji karyawan">Gaji Karyawan</option>
                                    <option value="biaya listrik">Biaya Listrik</option>
                                    <option value="perawatan kandang">Perawatan Kandang</option>
                                    <option value="lainnya">Lainnya</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="jumlah" class="form-label">Jumlah (Rp)</label>
                            <input type="number" class="form-control" id="jumlah" min="0" step="1000" required>
                        </div>
                        <div class="col-12">
                            <label for="keterangan" class="form-label">Keterangan</label>
                            <textarea class="form-control" id="keterangan" rows="2"></textarea>
                        </div>
                        <div class="col-12 d-grid gap-2">
                            <button type="submit" class="btn btn-success">Simpan Transaksi</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Ringkasan Keuangan -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card text-white bg-success">
                    <div class="card-body">
                        <h5>Total Pemasukan</h5>
                        <h2 id="totalMasuk">Rp 0</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-white bg-danger">
                    <div class="card-body">
                        <h5>Total Pengeluaran</h5>
                        <h2 id="totalKeluar">Rp 0</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-white bg-info">
                    <div class="card-body">
                        <h5>Saldo Akhir</h5>
                        <h2 id="saldoAkhir">Rp 0</h2>
                    </div>
                </div>
            </div>
        </div>

        <!-- Daftar Transaksi -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-secondary text-white">
                <h3>Riwayat Transaksi</h3>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Tanggal</th>
                                <th>Jenis</th>
                                <th>Kategori</th>
                                <th>Jumlah</th>
                                <th>Keterangan</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="transaksiList">
                            <!-- Data akan dimuat di sini -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Grafik Keuangan -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-warning text-dark">
                <h3>Grafik Keuangan Bulanan</h3>
            </div>
            <div class="card-body">
                <canvas id="keuanganChart" width="400" height="200"></canvas>
            </div>
        </div>
    </div>

    <footer class="text-center py-3 mt-4 border-top">
        <p>&copy; 2023 Bumdes Gunung Mulia | Peternakan Itik Petelur</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Data transaksi (simulasi database)
        let transaksi = JSON.parse(localStorage.getItem('transaksi')) || [];

        // Fungsi untuk menghitung total
        function hitungTotal() {
            const totalMasuk = transaksi.filter(t => t.jenis === 'masuk').reduce((sum, t) => sum + t.jumlah, 0);
            const totalKeluar = transaksi.filter(t => t.jenis === 'keluar').reduce((sum, t) => sum + t.jumlah, 0);
            const saldo = totalMasuk - totalKeluar;

            document.getElementById('totalMasuk').textContent = `Rp ${totalMasuk.toLocaleString()}`;
            document.getElementById('totalKeluar').textContent = `Rp ${totalKeluar.toLocaleString()}`;
            document.getElementById('saldoAkhir').textContent = `Rp ${saldo.toLocaleString()}`;

            return { totalMasuk, totalKeluar };
        }

        // Fungsi untuk menampilkan transaksi
        function tampilkanTransaksi() {
            const tbody = document.getElementById('transaksiList');
            tbody.innerHTML = '';

            transaksi.sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal)).forEach(transaksi => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(transaksi.tanggal).toLocaleDateString()}</td>
                    <td><span class="badge ${transaksi.jenis === 'masuk' ? 'bg-success' : 'bg-danger'}">${transaksi.jenis}</span></td>
                    <td>${transaksi.kategori}</td>
                    <td>Rp ${transaksi.jumlah.toLocaleString()}</td>
                    <td>${transaksi.keterangan}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-danger" onclick="hapusTransaksi(${transaksi.id})">Hapus</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Fungsi untuk membuat grafik
        function buatGrafik() {
            const bulanData = {};
            transaksi.forEach(t => {
                const bulan = new Date(t.tanggal).getMonth();
                if (!bulanData[bulan]) bulanData[bulan] = { masuk: 0, keluar: 0 };
                
                if (t.jenis === 'masuk') bulanData[bulan].masuk += t.jumlah;
                else bulanData[bulan].keluar += t.jumlah;
            });

            const bulanLabel = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'];
            const dataMasuk = [];
            const dataKeluar = [];

            for (let i = 0; i < 12; i++) {
                dataMasuk.push(bulanData[i]?.masuk || 0);
                dataKeluar.push(bulanData[i]?.keluar || 0);
            }

            const ctx = document.getElementById('keuanganChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: bulanLabel,
                    datasets: [
                        {
                            label: 'Pemasukan',
                            data: dataMasuk,
                            backgroundColor: 'rgba(40, 167, 69, 0.7)',
                            borderColor: 'rgba(40, 167, 69, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Pengeluaran',
                            data: dataKeluar,
                            backgroundColor: 'rgba(220, 53, 69, 0.7)',
                            borderColor: 'rgba(220, 53, 69, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'Rp ' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        // Fungsi untuk menambah transaksi
        document.getElementById('transactionForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const tanggal = document.getElementById('tanggal').value;
            const jenis = document.getElementById('jenis').value;
            const kategori = document.getElementById('kategori').value;
            const jumlah = parseInt(document.getElementById('jumlah').value);
            const keterangan = document.getElementById('keterangan').value;

            const transaksiBaru = {
                id: Date.now(),
                tanggal,
                jenis,
                kategori,
                jumlah,
                keterangan
            };

            transaksi.push(transaksiBaru);
            localStorage.setItem('transaksi', JSON.stringify(transaksi));

            // Reset form
            document.getElementById('transactionForm').reset();

            // Perbarui tampilan
            tampilkanTransaksi();
            hitungTotal();
            buatGrafik();
        });

        // Fungsi untuk menghapus transaksi
        function hapusTransaksi(id) {
            if (confirm('Apakah Anda yakin ingin menghapus transaksi ini?')) {
                transaksi = transaksi.filter(t => t.id !== id);
                localStorage.setItem('transaksi', JSON.stringify(transaksi));
                tampilkanTransaksi();
                hitungTotal();
                buatGrafik();
            }
        }

        // Inisialisasi halaman
        window.onload = function() {
            tampilkanTransaksi();
            hitungTotal();
            buatGrafik();
        };
    </script>
</body>
</html>